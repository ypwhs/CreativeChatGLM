# ğŸ’¡Creative ChatGLM WebUI

ğŸ‘‹ æ¬¢è¿æ¥åˆ° ChatGLM åˆ›æ„ä¸–ç•Œï¼ä½ å¯ä»¥ä½¿ç”¨ä¿®è®¢å’Œç»­å†™çš„åŠŸèƒ½æ¥ç”Ÿæˆåˆ›æ„å†…å®¹ï¼

* ğŸ“– ä½ å¯ä»¥ä½¿ç”¨â€œç»­å†™â€æŒ‰é’®å¸® ChatGLM æƒ³ä¸€ä¸ªå¼€å¤´ï¼Œå¹¶è®©å®ƒç»§ç»­ç”Ÿæˆæ›´å¤šçš„å†…å®¹ã€‚
* ğŸ“ ä½ å¯ä»¥ä½¿ç”¨â€œä¿®è®¢â€æŒ‰é’®ä¿®æ”¹æœ€åä¸€å¥ ChatGLM çš„å›å¤ã€‚

# ç¯å¢ƒé…ç½®

## ç¦»çº¿åŒ…

æ­¤å®‰è£…æ–¹æ³•é€‚åˆï¼š

* éå¼€å‘äººå‘˜ï¼Œä¸éœ€è¦å†™ä»£ç 
* æ²¡æœ‰Pythonç»éªŒï¼Œä¸ä¼šæ­å»ºç¯å¢ƒ
* ç½‘ç»œç¯å¢ƒä¸å¥½ï¼Œé…ç½®ç¯å¢ƒã€ä¸‹è½½æ¨¡å‹é€Ÿåº¦æ…¢

| åç§° | å¤§å° | ç™¾åº¦ç½‘ç›˜ | å¤‡æ³¨ |
| ---- | ---- | ---- | ---- |
| **å°æ˜¾å­˜ç¦»çº¿åŒ…** | 5.56 GB | [ç‚¹å‡»ä¸‹è½½](https://pan.baidu.com/s/1UU2KoqABYGOCPjrhq8fLZw?pwd=cglm) | ä½¿ç”¨ ChatGLM-6B-int4 æƒé‡çš„ç¦»çº¿åŒ…ï¼Œæ˜¾å­˜éœ€æ±‚ 8GB |
| å¤§æ˜¾å­˜ç¦»çº¿åŒ… | 14.3 GB | [ç‚¹å‡»ä¸‹è½½](https://pan.baidu.com/s/1w3GVPCO4I5m2rI9GvlEIYQ?pwd=cglm) | ä½¿ç”¨ ChatGLM-6B æƒé‡çš„ç¦»çº¿åŒ…ï¼Œæ˜¾å­˜éœ€æ±‚ 16GB |
| ç¯å¢ƒç¦»çº¿åŒ… | 2.56 GB | [ç‚¹å‡»ä¸‹è½½](https://pan.baidu.com/s/1JNhjUJ1B-tuCmsntLgqRYw?pwd=cglm) | ä¸å¸¦æƒé‡çš„ç¦»çº¿åŒ…ï¼Œå¯åŠ¨ä¹‹åå¯ä»¥è‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼Œé»˜è®¤è‡ªåŠ¨ä¸‹è½½ ChatGLM-6B æƒé‡ã€‚ |

é™¤äº†è¿™äº›ç¦»çº¿ä¸€é”®ç¯å¢ƒä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥åœ¨ä¸‹é¢ä¸‹è½½ä¸€äº›æ¨¡å‹çš„æƒé‡ï¼ŒåŒ…æ‹¬ `THUDM/chatglm-6b` ç³»åˆ—ã€`silver/chatglm-6b-slim` ç³»åˆ—ã€`BelleGroup/BELLE` ç³»åˆ—ã€‚

* ç™¾åº¦ç½‘ç›˜é“¾æ¥ï¼š[https://pan.baidu.com/s/1pnIEj66scZOswHm8oivXmw?pwd=cglm](https://pan.baidu.com/s/1pnIEj66scZOswHm8oivXmw?pwd=cglm)

ä¸‹è½½å¥½ç¯å¢ƒåŒ…ä¹‹åï¼Œè§£å‹ï¼Œç„¶åè¿è¡Œ `start_offline.bat` è„šæœ¬ï¼Œå³å¯å¯åŠ¨æœåŠ¡ï¼š

![image](https://user-images.githubusercontent.com/10473170/229680125-6af06b25-3d26-49cc-969b-4f6154c522de.png)

## è™šæ‹Ÿç¯å¢ƒ

æ­¤å®‰è£…æ–¹æ³•é€‚åˆå·²ç»å®‰è£…äº† Pythonï¼Œä½†æ˜¯å¸Œæœ›ç¯å¢ƒä¸ç³»ç»Ÿå·²å®‰è£…çš„ Python ç¯å¢ƒéš”ç¦»çš„ç”¨æˆ·ã€‚

<details><summary>ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†æ­¥éª¤</summary>

é¦–å…ˆå¯åŠ¨ `setup_venv.bat` è„šæœ¬ï¼Œå®‰è£…ç¯å¢ƒï¼š

![image](https://user-images.githubusercontent.com/10473170/227982667-a8090ffa-f836-4ebc-93a1-91ab39d9259b.png)

ç„¶åä½¿ç”¨ `start_venv.bat` è„šæœ¬å¯åŠ¨æœåŠ¡ï¼š

![image](https://user-images.githubusercontent.com/10473170/227983154-27ed9751-b9c3-44ec-9583-31f192955b11.png)

</details>

## Python å¼€å‘ç¯å¢ƒ

æ­¤é¡¹é…ç½®æ–¹æ³•é€‚åˆä»£ç å¼€å‘äººå‘˜ï¼Œä½¿ç”¨çš„æ˜¯è‡ªå·±ç³»ç»Ÿé‡Œå®‰è£…çš„ Pythonã€‚

ç¯å¢ƒé…ç½®å‚è€ƒå®˜æ–¹é“¾æ¥ï¼š[https://github.com/THUDM/ChatGLM-6B](https://github.com/THUDM/ChatGLM-6B)

é…ç½®å¥½ä¹‹åï¼Œè¿è¡Œ `app.py` å¼€å§‹ä½¿ç”¨ï¼Œæˆ–è€…ä½¿ç”¨ IDE å¼€å§‹å¼€å‘ã€‚

# ç”¨æ³•ä»‹ç»

## ç»­å†™

### åŸå§‹å¯¹è¯

å¦‚æœä½ ç›´æ¥é—® ChatGLMï¼šâ€œä½ å‡ å²äº†ï¼Ÿâ€

å®ƒåªä¼šå›ç­”ï¼šâ€œä½œä¸ºä¸€ä¸ªäººå·¥æ™ºèƒ½è¯­è¨€æ¨¡å‹ï¼Œæˆ‘æ²¡æœ‰å¹´é¾„ï¼Œæˆ‘åªæ˜¯ä¸€ä¸ªæ­£åœ¨ä¸æ–­å­¦ä¹ å’Œè¿›åŒ–çš„ç¨‹åºã€‚â€

<img width="388" alt="image" src="https://user-images.githubusercontent.com/10473170/227778266-e7f2b55a-59de-4eee-bfa2-f28f911ec018.png">

### ç»­å†™å¯¹è¯

è€Œå¦‚æœä½ ç»™å®ƒèµ·ä¸ªå¤´ï¼šâ€œæˆ‘ä»Šå¹´â€

å®ƒå°±ä¼šå›ç­”ï¼šâ€œæˆ‘ä»Šå¹´21å²ã€‚â€

<img width="388" alt="image" src="https://user-images.githubusercontent.com/10473170/227778334-d459ad8d-7c16-466d-851c-5af174216773.png">

### ä½¿ç”¨è§†é¢‘

![ChatGLM2](https://user-images.githubusercontent.com/10473170/227778636-a8fcd650-eeeb-44e5-8f24-9260b27cce5d.gif)

## ä¿®è®¢

### åŸå§‹å¯¹è¯

å¦‚æœä½ ç›´æ¥è·Ÿ ChatGLM è¯´ï¼šâ€œä½ æ˜¯è°ï¼Ÿâ€

å®ƒä¼šå›ç­”ï¼šâ€œæˆ‘æ˜¯ä¸€ä¸ªåä¸º ChatGLM-6B çš„äººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œæ˜¯åŸºäºæ¸…åå¤§å­¦ KEG å®éªŒå®¤å’Œæ™ºè°± AI å…¬å¸äº 2023 å¹´å…±åŒè®­ç»ƒçš„è¯­è¨€æ¨¡å‹å¼€å‘çš„ã€‚æˆ‘çš„ä»»åŠ¡æ˜¯é’ˆå¯¹ç”¨æˆ·çš„é—®é¢˜å’Œè¦æ±‚æä¾›é€‚å½“çš„ç­”å¤å’Œæ”¯æŒã€‚â€

ä½ å†é—®å®ƒï¼šâ€œä½ å‡ å²äº†ï¼Ÿâ€

å®ƒåªä¼šè¯´ï¼šâ€œä½œä¸ºä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œæˆ‘æ²¡æœ‰å¹´é¾„ï¼Œå› ä¸ºæˆ‘åªæ˜¯ä¸€ä¸ªç¨‹åºï¼Œæ²¡æœ‰å®é™…çš„è‚‰ä½“æˆ–ç”Ÿå‘½ã€‚æˆ‘åªæ˜¯ä¸€ä¸ªåœ¨è®¡ç®—æœºä¸Šè¿è¡Œçš„ç¨‹åºï¼Œä¸“é—¨è®¾è®¡ä¸ºå›ç­”ç”¨æˆ·çš„é—®é¢˜å’Œæä¾›ç›¸å…³çš„å¸®åŠ©ã€‚â€

![image](https://user-images.githubusercontent.com/10473170/227777039-75b9dfb6-9b83-45af-8555-c3a27808c683.png)

### ä¿®æ”¹å¯¹è¯

ä½ å¯ä»¥æ”¹å˜å®ƒçš„è§’è‰²ï¼Œæ¯”å¦‚ä½ é€šè¿‡â€œä¿®è®¢â€åŠŸèƒ½ï¼Œå°†å®ƒçš„å›å¤æ”¹æˆï¼šâ€œæˆ‘æ˜¯æ¨å¼€å¿ƒã€‚â€

ç„¶åä½ å†é—®å®ƒï¼šâ€œä½ å‡ å²äº†ï¼Ÿâ€

å®ƒå°±ä¼šå›ç­”ï¼šâ€œæˆ‘ä»Šå¹´15å²ã€‚â€

![image](https://user-images.githubusercontent.com/10473170/227777136-e2a176f8-6742-41a9-abaf-72a9540b834d.png)

### ä½¿ç”¨è§†é¢‘

![æœªå‘½åé¡¹ç›®](https://user-images.githubusercontent.com/10473170/227777930-6aa5981a-0695-40c7-b083-b76bb063c481.gif)

# å®ç°åŸç†

è¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰è®­ç»ƒï¼Œæ²¡æœ‰ä¿®æ”¹å®˜æ–¹å‘å¸ƒçš„æƒé‡ï¼Œè€Œåªæ˜¯å¯¹æ¨ç†çš„å‡½æ•°åšäº†ä¿®æ”¹ã€‚

ç»­å†™çš„åŸç†æ˜¯ï¼Œå°†ç”¨æˆ·çš„è¾“å…¥ç›´æ¥è®¾ç½®ä¸º `history[-1][1]`ï¼Œæ¨¡æ‹Ÿæ¨¡å‹è‡ªå·±çš„éƒ¨åˆ†è¾“å‡ºï¼Œç„¶åç»§ç»­èµ°ä¹‹åçš„æ¨ç†å‡½æ•° `stream_chat_continue` [code](https://github.com/ypwhs/CreativeChatGLM/blob/a5c6dd1/chatglm/modeling_chatglm.py#L1158)ã€‚

ä¿®è®¢çš„åŸç†æ˜¯ï¼Œå°†ç”¨æˆ·çš„è¾“å…¥ç›´æ¥è®¾ç½®ä¸º `history[-1][1]`ï¼Œæ¨¡æ‹Ÿæ¨¡å‹è‡ªå·±çš„å®Œæ•´è¾“å‡ºï¼Œä½†æ˜¯ä¸èµ°æ¨ç†å‡½æ•°ã€‚

# ç¦»çº¿åŒ…åˆ¶ä½œæ–¹æ³•

å…³äºæœ¬é¡¹ç›®ä¸­çš„ç¦»çº¿åŒ…åˆ¶ä½œæ–¹æ³•ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹é¢çš„è¯¦ç»†æ­¥éª¤ã€‚

<details><summary>ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†æ­¥éª¤</summary>

## å‡†å¤‡ Python

é¦–å…ˆå» Python å®˜ç½‘ä¸‹è½½ï¼š[https://www.python.org/downloads/](https://www.python.org/downloads/)

![image](https://user-images.githubusercontent.com/10473170/229679144-86d96c5c-58e0-4a54-9657-ccfe37943c6e.png)

æ³¨æ„è¦ä¸‹è½½ `Windows embeddable package (64-bit)` ç¦»çº¿åŒ…ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ [python-3.10.10-embed-amd64.zip](https://www.python.org/ftp/python/3.10.10/python-3.10.10-embed-amd64.zip)ã€‚

![image](https://user-images.githubusercontent.com/10473170/229679189-1f8b2032-c92c-47ee-ba25-147f4acbf90f.png)

è§£å‹åˆ° `./system/python` ç›®å½•ä¸‹ã€‚

![image](https://user-images.githubusercontent.com/10473170/229679264-b3633920-757f-4ab8-b9f8-e79a21036146.png)

## å‡†å¤‡ get-pip.py

å»å®˜ç½‘ä¸‹è½½ï¼š[https://bootstrap.pypa.io/get-pip.py](https://bootstrap.pypa.io/get-pip.py)

ä¿å­˜åˆ° `./system/python` ç›®å½•ä¸‹ã€‚

è§£å‹ä¹‹åï¼Œè®°å¾—åˆ é™¤ pth æ–‡ä»¶ï¼Œä»¥è§£å†³å®‰è£…ä¾èµ–çš„é—®é¢˜ã€‚

æ¯”å¦‚æˆ‘åˆ é™¤çš„æ–‡ä»¶è·¯å¾„æ˜¯ `./system/python/python310._pth`

![image](https://user-images.githubusercontent.com/10473170/229679450-7acc005d-8203-4dd6-8be9-fa546aeaa2bf.png)

## å®‰è£…ä¾èµ–

è¿è¡Œ [setup_offline.bat](setup_offline.bat) è„šæœ¬ï¼Œå®‰è£…ä¾èµ–ã€‚

![image](https://user-images.githubusercontent.com/10473170/229679544-162b8db1-851f-47f0-af54-675c6a710b42.png)

## ä¸‹è½½ç¦»çº¿æ¨¡å‹

ä½ å¯ä»¥ä½¿ç”¨ [download_model.py](download_model.py) è„šæœ¬ä¸‹è½½æ¨¡å‹ï¼Œå¦‚æœä½ çš„ç½‘ç»œç¯å¢ƒä¸å¥½ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šå¾ˆé•¿ã€‚ä¸‹è½½çš„æ¨¡å‹ä¼šå­˜åœ¨ `~/.cache` ä¸€ä»½ï¼Œå­˜åœ¨ `./models` ä¸€ä»½ã€‚

å½“ä½ ä¹‹åä½¿ç”¨ `AutoModel.from_pretrained` åŠ è½½æ¨¡å‹æ—¶ï¼Œå¯ä»¥ä» `~/.cache` ç¼“å­˜ç›®å½•åŠ è½½æ¨¡å‹ï¼Œé¿å…äºŒæ¬¡ä¸‹è½½ã€‚

![image](https://user-images.githubusercontent.com/10473170/229679938-44486557-dbc7-4e0b-9793-acfb6c46459e.png)

ä¸‹è½½å¥½çš„æ¨¡å‹ï¼Œä½ éœ€è¦ä» `./models` æ–‡ä»¶å¤¹ç§»å‡ºåˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œè¿™æ ·å°±å¯ä»¥ç¦»çº¿åŠ è½½äº†ã€‚

![image](https://user-images.githubusercontent.com/10473170/229680125-6af06b25-3d26-49cc-969b-4f6154c522de.png)

ä¸‹è½½å®Œæ¨¡å‹ä¹‹åï¼Œä½ éœ€è¦ä¿®æ”¹ [app.py](app.py) é‡Œçš„ `model_name`ï¼Œæ”¹æˆä½ æƒ³åŠ è½½çš„æ¨¡å‹åç§°ã€‚

## æµ‹è¯•

ä½¿ç”¨ [start_offline.bat](start_offline.bat) å¯åŠ¨æœåŠ¡ï¼š

![image](https://user-images.githubusercontent.com/10473170/229680404-0b28dfd4-382e-4cfc-9392-997f134c0242.png)

å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡æ­£å¸¸å¯åŠ¨ã€‚

</details>

# åè®®

æœ¬ä»“åº“çš„ä»£ç ä¾ç…§ [Apache-2.0](LICENSE) åè®®å¼€æºï¼ŒChatGLM-6B æ¨¡å‹çš„æƒé‡çš„ä½¿ç”¨åˆ™éœ€è¦éµå¾ª [Model License](MODEL_LICENSE)ã€‚
